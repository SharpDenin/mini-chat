syntax = "proto3";

package chat;
option go_package = "./gRPC";

import "google/protobuf/timestamp.proto";

service Presence {
  // Подключение пользователя (WS/Open session)
  rpc OnConnect(OnConnectRequest) returns (EmptyResponse);

  // Отключение пользователя
  rpc OnDisconnect(OnDisconnectRequest) returns (EmptyResponse);

  // Heartbeat / продление активности
  rpc OnHeartbeat(OnHeartbeatRequest) returns (EmptyResponse);

  // Получение presence пользователя
  rpc GetPresence(GetPresenceRequest) returns (GetPresenceResponse);

  // Получение списка онлайн друзей
  rpc GetOnlineFriends(GetOnlineFriendsRequest) returns (GetOnlineFriendsResponse);
}

// ---------------- Requests ----------------

message OnConnectRequest {
  int64 user_id = 1;
  int64 conn_id = 2;
  string device = 3;
}

message OnDisconnectRequest {
  int64 user_id = 1;
  int64 conn_id = 2;
}

message OnHeartbeatRequest {
  int64 conn_id = 1;
}

message GetPresenceRequest {
  int64 user_id = 1;
}

message GetOnlineFriendsRequest {
  int64 user_id = 1;
  repeated int64 friends_ids = 2;
}

// ---------------- Responses ----------------

message EmptyResponse {}

message GetPresenceResponse {
  int64 user_id = 1;
  string status = 2; // "online", "idle", "offline"
  google.protobuf.Timestamp last_seen = 3;
}

message GetOnlineFriendsResponse {
  repeated int64 online_friends = 1;
}
